<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <base href="/">

        <title>Tapcode</title>

        <meta name="description" content="Tapcode">
        <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=no">

        <!-- Icons -->
        <link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png">
        <link rel="shortcut icon" href="assets/favicons/favicon.ico">
        <link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png">
        <link rel="mask-icon" href="assets/favicons/safari-pinned-tab.svg" color="#ff6900">

        <!-- Custom font -->
        <link href="https://fonts.googleapis.com/css?family=Space+Mono:400,700" rel="stylesheet">

        <!-- Web-app support -->
        <link rel="manifest" href="./manifest.json">
        <meta name="msapplication-config" content="./browserconfig.xml">
        <meta name="theme-color" content="#292f35">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <!-- iOS startup images -->

        <!-- iPhone 5 startup image -->
        <link href="/assets/favicons/splash640x1096.png"
              media="(device-width: 320px) and (device-height: 568px)
                     and (-webkit-device-pixel-ratio: 2)"
              rel="apple-touch-startup-image">

        <!-- iPhone < 5 retina startup image -->
        <link href="/assets/favicons/splash640x920.png"
              media="(device-width: 320px) and (device-height: 480px)
                     and (-webkit-device-pixel-ratio: 2)"
              rel="apple-touch-startup-image">

        <!-- iPhone < 5 non-retina startup image -->
        <link href="/assets/favicons/splash320x460.png"
              media="(device-width: 320px) and (device-height: 480px)
                     and (-webkit-device-pixel-ratio: 1)"
              rel="apple-touch-startup-image">

        <!-- For Google -->
        <meta name="description" content="A creative coding tool from Kano"/>
        <meta name="keywords" content="Tapcode Kano Computing Creative Coding"/>
        <meta name="application-name" content="Tapcode"/>

        <!-- For Facebook -->
        <meta property="og:title" content="Tapcode"/>
        <meta property="og:url" content="https://tapcode.kano.me/assets/social/tapcode.gif"/>
        <meta property="og:image" content="https://tapcode.kano.me/assets/social/tapcode.gif"/>
        <meta property="og:description" content="A creative coding tool from Kano"/>

        <!-- For Twitter -->
        <meta name="twitter:title" content="Tapcode"/>
        <meta name="twitter:description" content="A creative coding tool from Kano"/>
        <meta name="twitter:image" content="assets/social/tapcode.gif"/>
        <meta name="twitter:card" content="summary"/>

        <!-- build:env -->
        <script>
            window.Kano = window.Kano || {};
            window.Kano.Tapcode = window.Kano.Tapcode || {};
            window.Kano.Tapcode.Config = window.Kano.Tapcode.Config || {};
            window.Kano.Tapcode.Config.ENV = 'staging';
        </script>
        <!-- endbuild-->

        <!-- build:es5adapter -->
        <!-- endbuild -->
        
        <script src="./bower_components/webcomponentsjs/webcomponents-loader.js"></script>

        <link rel="import" href="./src/config/default.html">
        <!-- build:config -->
        <link rel="import" href="./src/config/development.html">
        <!-- endbuild -->
        <style>
            html, body {
                height: 100%;
                margin: 0;
                background: #292f35;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            * {
                user-select: none;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            }
            tc-app {
                height: 100%;
                box-sizing: border-box;
            }
            #splash {
                position: absolute;
                top: 0px;
                bottom: 0px;
                left: 0px;
                right: 0px;
                height: 100%;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                background-color: #292f35;
                z-index: 101;
                transition: opacity 440ms;
                opacity: 1;
            }
            img#kano-logo {
                display: block;
                height: 70px;
                padding: 8px;
                margin: 0 auto;
                transform: scale(0.8);
                opacity: 0;
            }
            .animate-in {
                animation: animateIn 280ms ease-in-out forwards;
            }
            .animate-out {
                animation: animateOut 280ms ease-in-out forwards;
            }
            @keyframes animateIn {
                0% {transform: scale(0); opacity: 0;}
                56% {transform: scale(1); opacity: 1;}
                100% {transform: scale(0.8); opacity: 1;}
            }
            
            @keyframes animateOut {
                0% {transform: scale(0.8); opacity: 1;}
                44% {transform: scale(1); opacity: 1;}
                100% {transform: scale(0); opacity: 0;}
            }
            
        </style>
    </head>
    <body>
        <div id="splash">
            <img id="kano-logo" src="assets/kano-logo.svg">
            <audio id="sound-on" preload="auto">
                <source src="assets/soundOn.m4a" type="audio/mp4"/>
                <source src="assets/soundOn.ogg" type="audio/ogg"/>
            </audio>
            <audio id="sound-off" preload="auto">
                <source src="assets/soundOff.m4a" type="audio/mp4"/>
                <source src="assets/soundOff.ogg" type="audio/ogg"/>
            </audio>
        </div>
        <tc-app id="app"></tc-app>
        
        <script type="text/javascript">
                var lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    var now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                var splash = document.getElementById('splash'),
                    logo = document.getElementById('kano-logo'),
                    soundOn = document.getElementById('sound-on'),
                    soundOff = document.getElementById('sound-off'),
                    app = document.getElementById('app'),
                    appReady,
                    timeUp;
                
                window.onload = function () {
                    if (Kano.Tapcode.Config.DEBUG) {
                        timeUp = true;
                        lazyLoadApp();
                        tryLoad();
                        return;
                    }
                    logo.classList.add('animate-in');
                    soundOn.volume = 0.5;
                    soundOn.play();
                    lazyLoadApp();
                    
                    setTimeout(function () {
                        timeUp = true;
                        tryLoad();
                    }, 1200);
                };
                
                function tryLoad () {
                    if (appReady && timeUp) {
                        showEditor();
                    }
                }
                
                function lazyLoadApp () {
                    var appImport = document.createElement('link');
                    appImport.rel = 'import';
                    appImport.href = '/src/tc-app.html';
                    appImport.id = 'appImport';
                    app.addEventListener('firstpageloaded', onFirstPageLoaded);
                    document.head.appendChild(appImport);
                }
                
                function onFirstPageLoaded () {
                    appReady = true;
                    tryLoad();
                    app.removeEventListener('firstpageloaded', onFirstPageLoaded);
                }
                
                function showEditor () {
                    logo.classList.remove('animate-in');
                    logo.classList.add('animate-out');
                    soundOff.volume = 0.5;
                    soundOff.play();

                    setTimeout(function () {
                        document.getElementById('splash').style.opacity = '0';
                    }, 280);

                    setTimeout(function () {
                        while (splash.firstChild) {
                            splash.removeChild(splash.firstChild);
                        }
                        splash.parentNode.removeChild(splash);
                        app.loading = false;
                    }, 760);
                }

        </script>
    </body>
</html>
